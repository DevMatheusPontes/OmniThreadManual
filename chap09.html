<!DOCTYPE html>
<html lang="en">

<!-- Mirrored from www.omnithreadlibrary.com/book/chap09.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 19 Oct 2025 22:29:00 GMT -->
<head>
  <meta charset="utf-8">
  <title>6. Miscellaneous</title>
  <link href="stylesheet.css" rel="stylesheet" />
</head>
<body dir="ltr" class="kramdown">
<div id="leanpub-toc">
<h2></h2>
<ol class="toc">
<ul class='toc no-parts'>
  <li>
    <a href='chap00.html#intro-advert'>About me</a>
  </li>
  <li>
    <a href='chap01.html#credits'>Credits</a>
  </li>
  <li>
    <a href='chap02.html#introduction'>Introduction</a>
    <ul>
      <li>
        <a href='chap02.html#leanpub-auto-formatting-conventions'>Formatting conventions</a>
      </li>
      <li>
        <a href='chap02.html#leanpub-auto-learn-more'>Learn more</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap03.html#leanpub-auto-release-notes'>Release notes</a>
  </li>
  <li>
    <a href='chap04.html#intro-mt'><span class="section-number">1. </span>Introduction to multi-threading</a>
    <ul>
      <li>
        <a href='chap04.html#leanpub-auto-multi-threading-as-a-source-of-problems'><span class="section-number">1.1 </span>Multi-threading as a source of problems</a>
        <ul>
          <li>
            <a href='chap04.html#leanpub-auto-reading-and-writing-shared-data'><span class="section-number">1.1.1 </span>Reading and writing shared data</a>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-modifying-shared-data'><span class="section-number">1.1.2 </span>Modifying shared data</a>
          </li>
          <li>
            <a href='chap04.html#leanpub-auto-writes-masquerading-as-reads'><span class="section-number">1.1.3 </span>Writes masquerading as reads</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap05.html#intro-otl'><span class="section-number">2. </span>Introduction to OmniThreadLibrary</a>
    <ul>
      <li>
        <a href='chap05.html#leanpub-auto-requirements'><span class="section-number">2.1 </span>Requirements</a>
      </li>
      <li>
        <a href='chap05.html#leanpub-auto-license'><span class="section-number">2.2 </span>License</a>
      </li>
      <li>
        <a href='chap05.html#installation'><span class="section-number">2.3 </span>Installation</a>
        <ul>
          <li>
            <a href='chap05.html#appendix-installing-getit'><span class="section-number">2.3.1 </span>Installing with GetIt</a>
          </li>
          <li>
            <a href='chap05.html#appendix-installing-delphinus'><span class="section-number">2.3.2 </span>Installing with Delphinus</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-installing-design-package'><span class="section-number">2.3.3 </span>Installing design package</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap05.html#leanpub-auto-why-use-omnithreadlibrary'><span class="section-number">2.4 </span>Why use OmniThreadLibrary?</a>
      </li>
      <li>
        <a href='chap05.html#introotl-tasksvsthreads'><span class="section-number">2.5 </span>Tasks vs. threads</a>
      </li>
      <li>
        <a href='chap05.html#introotl-lockingvsmessaging'><span class="section-number">2.6 </span>Locking vs. messaging</a>
      </li>
      <li>
        <a href='chap05.html#introotl-messagelooprequired'><span class="section-number">2.7 </span>Message loop required</a>
        <ul>
          <li>
            <a href='chap05.html#introotl-messagelooprequired-console'><span class="section-number">2.7.1 </span>OmniThreadLibrary and console</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-omnithreadlibrary-task-started-from-another-task'><span class="section-number">2.7.2 </span>OmniThreadLibrary task started from another task</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-omnithreadlibrary-task-started-from-a-tthread'><span class="section-number">2.7.3 </span>OmniThreadLibrary task started from a TThread</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap05.html#introotl-tomnivalue'><span class="section-number">2.8 </span>TOmniValue</a>
        <ul>
          <li>
            <a href='chap05.html#leanpub-auto-data-access'><span class="section-number">2.8.1 </span>Data access</a>
          </li>
          <li>
            <a href='chap05.html#introotl-tomnivalue-typetesting'><span class="section-number">2.8.2 </span>Type testing</a>
          </li>
          <li>
            <a href='chap05.html#introotl-tomnivalue-clearing'><span class="section-number">2.8.3 </span>Clearing the content</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-operators'><span class="section-number">2.8.4 </span>Operators</a>
          </li>
          <li>
            <a href='chap05.html#introotl-tomnivalue-generictypes'><span class="section-number">2.8.5 </span>Using with generic types</a>
          </li>
          <li>
            <a href='chap05.html#introotl-tomnivalue-array'><span class="section-number">2.8.6 </span>Array access</a>
          </li>
          <li>
            <a href='chap05.html#introotl-tomnivalue-records'><span class="section-number">2.8.7 </span>Handling records</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-object-ownership'><span class="section-number">2.8.8 </span>Object ownership</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-working-with-tvalue'><span class="section-number">2.8.9 </span>Working with TValue</a>
          </li>
          <li>
            <a href='chap05.html#leanpub-auto-low-level-methods'><span class="section-number">2.8.10 </span>Low-level methods</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap05.html#leanpub-auto-tomnivalueobj'><span class="section-number">2.9 </span>TOmniValueObj</a>
      </li>
      <li>
        <a href='chap05.html#introotl-fluentinterfaces'><span class="section-number">2.10 </span>Fluent interfaces</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap06.html#highlevel'><span class="section-number">3. </span>High-level multi-threading</a>
    <ul>
      <li>
        <a href='chap06.html#highlevel-introduction'><span class="section-number">3.1 </span>Introduction</a>
        <ul>
          <li>
            <a href='chap06.html#leanpub-auto-a-life-cycle-of-an-abstraction'><span class="section-number">3.1.1 </span>A life cycle of an abstraction</a>
          </li>
          <li>
            <a href='chap06.html#highLevel-intro-AnonymousEtAl'><span class="section-number">3.1.2 </span>Anonymous methods, procedures, and methods</a>
          </li>
          <li>
            <a href='chap06.html#highlevel-introduction-pooling'><span class="section-number">3.1.3 </span>Pooling</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#highlevel-blocking-collection'><span class="section-number">3.2 </span>Blocking collection</a>
        <ul>
          <li>
            <a href='chap06.html#highlevel-blocking-collection-iomniblockingcollection'><span class="section-number">3.2.1 </span>IOmniBlockingCollection</a>
          </li>
          <li>
            <a href='chap06.html#highlevel-blocking-collection-bulk-impexp'><span class="section-number">3.2.2 </span>Bulk import and export</a>
          </li>
          <li>
            <a href='chap06.html#highlevel-blocking-collection-throttling'><span class="section-number">3.2.3 </span>Throttling</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#highlevel-taskconfig'><span class="section-number">3.3 </span>Task configuration</a>
      </li>
      <li>
        <a href='chap06.html#highlevel-async'><span class="section-number">3.4 </span>Async</a>
        <ul>
          <li>
            <a href='chap06.html#leanpub-auto-handling-exceptions'><span class="section-number">3.4.1 </span>Handling exceptions</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#highlevel-asyncawait'><span class="section-number">3.5 </span>Async/Await</a>
      </li>
      <li>
        <a href='chap06.html#highlevel-future'><span class="section-number">3.6 </span>Future</a>
        <ul>
          <li>
            <a href='chap06.html#leanpub-auto-iomnifuturet-interface'><span class="section-number">3.6.1 </span>IOmniFuture&lt;T&gt; interface</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-completion-detection'><span class="section-number">3.6.2 </span>Completion detection</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-cancellation'><span class="section-number">3.6.3 </span>Cancellation</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-handling-exceptions-1'><span class="section-number">3.6.4 </span>Handling exceptions</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-examples'><span class="section-number">3.6.5 </span>Examples</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#highlevel-join'><span class="section-number">3.7 </span>Join</a>
        <ul>
          <li>
            <a href='chap06.html#leanpub-auto-iomniparalleljoin-interface'><span class="section-number">3.7.1 </span>IOmniParallelJoin interface</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-iomnijoinstate-interface'><span class="section-number">3.7.2 </span>IOmniJoinState interface</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-cancellation-1'><span class="section-number">3.7.3 </span>Cancellation</a>
          </li>
          <li>
            <a href='chap06.html#highlevel-join-exceptions'><span class="section-number">3.7.4 </span>Handling exceptions</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#highlevel-paralleltask'><span class="section-number">3.8 </span>Parallel task</a>
        <ul>
          <li>
            <a href='chap06.html#leanpub-auto-iomniparalleltask-interface'><span class="section-number">3.8.1 </span>IOmniParallelTask interface</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-example'><span class="section-number">3.8.2 </span>Example</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-handling-exceptions-2'><span class="section-number">3.8.3 </span>Handling exceptions</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-examples-1'><span class="section-number">3.8.4 </span>Examples</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#highlevel-backgroundworker'><span class="section-number">3.9 </span>Background worker</a>
        <ul>
          <li>
            <a href='chap06.html#leanpub-auto-basics'><span class="section-number">3.9.1 </span>Basics</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-iomnibackgroundworker-interface'><span class="section-number">3.9.2 </span>IOmniBackgroundWorker interface</a>
          </li>
          <li>
            <a href='chap06.html#highlevel-backgroundworker-initialization'><span class="section-number">3.9.3 </span>Task initialization</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-work-item-configuration'><span class="section-number">3.9.4 </span>Work item configuration</a>
          </li>
          <li>
            <a href='chap06.html#highlevel-backgroundworker-iomniworkitem'><span class="section-number">3.9.5 </span>Work item interface</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-examples-2'><span class="section-number">3.9.6 </span>Examples</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#highlevel-pipeline'><span class="section-number">3.10 </span>Pipeline</a>
        <ul>
          <li>
            <a href='chap06.html#leanpub-auto-background'><span class="section-number">3.10.1 </span>Background</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-basics-1'><span class="section-number">3.10.2 </span>Basics</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-iomnipipeline-interface'><span class="section-number">3.10.3 </span>IOmniPipeline interface</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-example-1'><span class="section-number">3.10.3.1 </span>Example</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-generators-mutators-and-aggregators'><span class="section-number">3.10.4 </span>Generators, mutators, and aggregators</a>
          </li>
          <li>
            <a href='chap06.html#highlevel-pipeline-throttling'><span class="section-number">3.10.5 </span>Throttling</a>
          </li>
          <li>
            <a href='chap06.html#highlevel-pipeline-parallel'><span class="section-number">3.10.6 </span>Parallel stages</a>
          </li>
          <li>
            <a href='chap06.html#highlevel-pipeline-exceptions'><span class="section-number">3.10.7 </span>Exceptions</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-examples-3'><span class="section-number">3.10.8 </span>Examples</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#highlevel-for'><span class="section-number">3.11 </span>Parallel for</a>
        <ul>
          <li>
            <a href='chap06.html#highlevel-for-iomniparallelsimpleloop'><span class="section-number">3.11.1 </span>IOmniParallelSimpleLoop interface</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-iterating-over-an-array'><span class="section-number">3.11.2 </span>Iterating over an array</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-examples-4'><span class="section-number">3.11.3 </span>Examples</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#highlevel-foreach'><span class="section-number">3.12 </span>ForEach</a>
        <ul>
          <li>
            <a href='chap06.html#leanpub-auto-cooperation'><span class="section-number">3.12.1 </span>Cooperation</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-iterating-over-'><span class="section-number">3.12.2 </span>Iterating over …</a>
            <ul>
              <li>
                <a href='chap06.html#leanpub-auto-number-ranges'><span class="section-number">3.12.2.1 </span>… Number ranges</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-enumerable-collections'><span class="section-number">3.12.2.2 </span>… Enumerable collections</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-thread-safe-enumerable-collections'><span class="section-number">3.12.2.3 </span>… Thread-safe enumerable collections</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-blocking-collections'><span class="section-number">3.12.2.4 </span>… Blocking collections</a>
              </li>
              <li>
                <a href='chap06.html#leanpub-auto-anything'><span class="section-number">3.12.2.5 </span>… Anything</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-providing-external-input'><span class="section-number">3.12.3 </span>Providing external input</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-iomniparallelloop-interface'><span class="section-number">3.12.4 </span>IOmniParallelLoop interface</a>
          </li>
          <li>
            <a href='chap06.html#highlevel-foreach-preserveorder'><span class="section-number">3.12.5 </span>Preserving output order</a>
          </li>
          <li>
            <a href='chap06.html#highlevel-foreach-aggregation'><span class="section-number">3.12.6 </span>Aggregation</a>
          </li>
          <li>
            <a href='chap06.html#highlevel-foreach-cancellation'><span class="section-number">3.12.7 </span>Cancellation</a>
          </li>
          <li>
            <a href='chap06.html#highlevel-foreach-taskinit'><span class="section-number">3.12.8 </span>Task initialization and finalization</a>
          </li>
          <li>
            <a href='chap06.html#highlevel-foreach-exceptions'><span class="section-number">3.12.9 </span>Handling exceptions</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-examples-5'><span class="section-number">3.12.10 </span>Examples</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#highlevel-forkjoin'><span class="section-number">3.13 </span>Fork/Join</a>
        <ul>
          <li>
            <a href='chap06.html#leanpub-auto-iomniforkjoin-interface'><span class="section-number">3.13.1 </span>IOmniForkJoin interface</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-iomnicompute-interface'><span class="section-number">3.13.2 </span>IOmniCompute interface</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-iomnicomputet-interface'><span class="section-number">3.13.3 </span>IOmniCompute&lt;T&gt; interface</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-exceptions'><span class="section-number">3.13.4 </span>Exceptions</a>
          </li>
          <li>
            <a href='chap06.html#leanpub-auto-examples-6'><span class="section-number">3.13.5 </span>Examples</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#highlevel-map'><span class="section-number">3.14 </span>Map</a>
        <ul>
          <li>
            <a href='chap06.html#leanpub-auto-iomniparallelmappert1t2-interface'><span class="section-number">3.14.1 </span>IOmniParallelMapper&lt;T1,T2&gt; interface</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap06.html#highlevel-timedtask'><span class="section-number">3.15 </span>Timed task</a>
        <ul>
          <li>
            <a href='chap06.html#highlevel-timedtask-iomnitimedtask'><span class="section-number">3.15.1 </span>IOmniTimedTask interface</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap07.html#lowlevel'><span class="section-number">4. </span>Low-level multi-threading</a>
    <ul>
      <li>
        <a href='chap07.html#leanpub-auto-low-level-for-the-impatient'><span class="section-number">4.1 </span>Low-level for the impatient</a>
      </li>
      <li>
        <a href='chap07.html#lowlevel-fourways'><span class="section-number">4.2 </span>Four ways to create a task</a>
      </li>
      <li>
        <a href='chap07.html#lowlevel-iomnitaskcontrol'><span class="section-number">4.3 </span>IOmniTaskControl and IOmniTask interfaces</a>
      </li>
      <li>
        <a href='chap07.html#lowlevel-taskControllerOwner'><span class="section-number">4.4 </span>Task controller needs an owner</a>
      </li>
      <li>
        <a href='chap07.html#lowlevel-communication'><span class="section-number">4.5 </span>Communication subsystem</a>
      </li>
      <li>
        <a href='chap07.html#leanpub-auto-processor-groups-and-numa-nodes'><span class="section-number">4.6 </span>Processor groups and NUMA nodes</a>
      </li>
      <li>
        <a href='chap07.html#lowlevel-threadpool'><span class="section-number">4.7 </span>Thread pooling</a>
        <ul>
          <li>
            <a href='chap07.html#leanpub-auto-execution-flow'><span class="section-number">4.7.1 </span>Execution flow</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-threadpool-interface'><span class="section-number">4.7.2 </span>IOmniThreadPool interface</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-threadpool-exitcode'><span class="section-number">4.7.3 </span>Task exit code</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-threadpool-monitoring'><span class="section-number">4.7.4 </span>Monitoring thread pool operations</a>
          </li>
          <li>
            <a href='chap07.html#leanpub-auto-processor-groups-and-numa-nodes-1'><span class="section-number">4.7.5 </span>Processor groups and NUMA nodes</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap07.html#lowlevel-lockfree'><span class="section-number">4.8 </span>Lock-free collections</a>
        <ul>
          <li>
            <a href='chap07.html#lowlevel-lockfree-boundedstack'><span class="section-number">4.8.1 </span>Bounded Stack</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-lockfree-boundedqueue'><span class="section-number">4.8.2 </span>Bounded queue</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-lockfree-messagequeue'><span class="section-number">4.8.3 </span>Message queue</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-lockfree-dynamicqueue'><span class="section-number">4.8.4 </span>Dynamic queue</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-lockfree-observing'><span class="section-number">4.8.5 </span>Observing lock-free collections</a>
            <ul>
              <li>
                <a href='chap07.html#leanpub-auto-examples-7'><span class="section-number">4.8.5.1 </span>Examples</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap07.html#leanpub-auto-benchmarks'><span class="section-number">4.8.6 </span>Benchmarks</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap07.html#lowlevel-eventmonitor'><span class="section-number">4.9 </span>Event monitor</a>
      </li>
      <li>
        <a href='chap07.html#lowlevel-simpletasks'><span class="section-number">4.10 </span>Simple tasks</a>
        <ul>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-name'><span class="section-number">4.10.1 </span>Name</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-uniqueid'><span class="section-number">4.10.2 </span>UniqueID</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-parameters'><span class="section-number">4.10.3 </span>Parameters</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-termination'><span class="section-number">4.10.4 </span>Termination</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-exitcode'><span class="section-number">4.10.5 </span>ExitCode</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-taskexceptions'><span class="section-number">4.10.6 </span>Exceptions</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-communication'><span class="section-number">4.10.7 </span>Sending messages to a task</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-receiving'><span class="section-number">4.10.8 </span>Receiving messages from a task</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-chainto'><span class="section-number">4.10.9 </span>ChainTo</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-joinleave'><span class="section-number">4.10.10 </span>Join / Leave</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-monitorwith'><span class="section-number">4.10.11 </span>MonitorWith / RemoveMonitor</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-enforced'><span class="section-number">4.10.12 </span>Enforced</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-unobserved'><span class="section-number">4.10.13 </span>Unobserved</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-cancellationtoken'><span class="section-number">4.10.14 </span>Cancellation token / CancelWith</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-tasklock'><span class="section-number">4.10.15 </span>Lock / WithLock</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-counter'><span class="section-number">4.10.16 </span>WithCounter</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-simpletasks-setpriority'><span class="section-number">4.10.17 </span>SetPriority</a>
          </li>
          <li>
            <a href='chap07.html#leanpub-auto-setqueuesize'><span class="section-number">4.10.18 </span>SetQueueSize</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap07.html#lowlevel-tomniworker'><span class="section-number">4.11 </span>TOmniWorker tasks</a>
        <ul>
          <li>
            <a href='chap07.html#lowlevel-tomniworker-waitforinit'><span class="section-number">4.11.1 </span>WaitForInit</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-tomniworker-task'><span class="section-number">4.11.2 </span>Task</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-tomniworker-communication'><span class="section-number">4.11.3 </span>Receiving messages</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-tomniworker-registercomm'><span class="section-number">4.11.4 </span>RegisterComm</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-tomniworker-tomniworkerinvoke'><span class="section-number">4.11.5 </span>Invoke</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-tomniworker-msgwait'><span class="section-number">4.11.6 </span>Windows message &amp; APC processing</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-tomniworker-timers'><span class="section-number">4.11.7 </span>Timers</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-tomniworker-terminateWhen'><span class="section-number">4.11.8 </span>TerminateWhen</a>
          </li>
          <li>
            <a href='chap07.html#leanpub-auto-userdata'><span class="section-number">4.11.9 </span>UserData</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap07.html#lowlevel-taskgroup'><span class="section-number">4.12 </span>Task groups</a>
      </li>
      <li>
        <a href='chap07.html#lowlevel-iomnitask'><span class="section-number">4.13 </span>IOmniTask interface</a>
        <ul>
          <li>
            <a href='chap07.html#leanpub-auto-name-and-id'><span class="section-number">4.13.1 </span>Name and ID</a>
          </li>
          <li>
            <a href='chap07.html#leanpub-auto-parameters'><span class="section-number">4.13.2 </span>Parameters</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-iomnitask-termination'><span class="section-number">4.13.3 </span>Termination</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-iomnitask-exitstatus'><span class="section-number">4.13.4 </span>Exit status</a>
          </li>
          <li>
            <a href='chap07.html#leanpub-auto-exceptions-1'><span class="section-number">4.13.5 </span>Exceptions</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-iomnitask-communication'><span class="section-number">4.13.6 </span>Communication</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-iomnitask-timers'><span class="section-number">4.13.7 </span>Timers</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-iomnitask-registerwaitobject'><span class="section-number">4.13.8 </span>RegisterWaitObject</a>
          </li>
          <li>
            <a href='chap07.html#leanpub-auto-cancellationtoken'><span class="section-number">4.13.9 </span>CancellationToken</a>
          </li>
          <li>
            <a href='chap07.html#lowlevel-iomnitask-lock'><span class="section-number">4.13.10 </span>Lock</a>
          </li>
          <li>
            <a href='chap07.html#leanpub-auto-counter'><span class="section-number">4.13.11 </span>Counter</a>
          </li>
          <li>
            <a href='chap07.html#leanpub-auto-processor-groups-and-numa-nodes-2'><span class="section-number">4.13.12 </span>Processor groups and NUMA nodes</a>
          </li>
          <li>
            <a href='chap07.html#leanpub-auto-internal-and-obsolete-functions'><span class="section-number">4.13.13 </span>Internal and obsolete functions</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap08.html#synch'><span class="section-number">5. </span>Synchronization</a>
    <ul>
      <li>
        <a href='chap08.html#synch-criticalsections'><span class="section-number">5.1 </span>Critical sections</a>
        <ul>
          <li>
            <a href='chap08.html#synch-criticalsections-iomnicriticalsection'><span class="section-number">5.1.1 </span>IOmniCriticalSection</a>
          </li>
          <li>
            <a href='chap08.html#synch-criticalsections-tomnics'><span class="section-number">5.1.2 </span>TOmniCS</a>
          </li>
          <li>
            <a href='chap08.html#synch-criticalsections-lockedt'><span class="section-number">5.1.3 </span>Locked&lt;T&gt;</a>
            <ul>
              <li>
                <a href='chap08.html#leanpub-auto-why-not-use-tmonitor'><span class="section-number">5.1.3.1 </span>Why not use TMonitor?</a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap08.html#synch-tomnimrew'><span class="section-number">5.2 </span>TOmniMREW</a>
      </li>
      <li>
        <a href='chap08.html#synch-cancellationtoken'><span class="section-number">5.3 </span>Cancellation token</a>
      </li>
      <li>
        <a href='chap08.html#synch-waitablevalue'><span class="section-number">5.4 </span>Waitable value</a>
      </li>
      <li>
        <a href='chap08.html#synch-inversesemaphore'><span class="section-number">5.5 </span>Inverse semaphore</a>
      </li>
      <li>
        <a href='chap08.html#synch-initialization'><span class="section-number">5.6 </span>Initialization</a>
        <ul>
          <li>
            <a href='chap08.html#synch-initialization-pessimistic'><span class="section-number">5.6.1 </span>Pessimistic initialization</a>
          </li>
          <li>
            <a href='chap08.html#synch-initialization-optimistic'><span class="section-number">5.6.2 </span>Optimistic initialization</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap08.html#synch-twaitfor'><span class="section-number">5.7 </span>TWaitFor</a>
      </li>
      <li>
        <a href='chap08.html#synch-tomnilockmanager'><span class="section-number">5.8 </span>TOmniLockManager&lt;K&gt;</a>
      </li>
      <li>
        <a href='chap08.html#synch-tomnisinglethreadusechecker'><span class="section-number">5.9 </span>TOmniSingleThreadUseChecker</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap09.html#misc'><span class="section-number">6. </span>Miscellaneous</a>
    <ul>
      <li>
        <a href='chap09.html#misc-tOmniTwoWayChannel'><span class="section-number">6.1 </span>TOmniTwoWayChannel</a>
      </li>
      <li>
        <a href='chap09.html#misc-tomnivaluecontainer'><span class="section-number">6.2 </span>TOmniValueContainer</a>
      </li>
      <li>
        <a href='chap09.html#misc-tomnicounter'><span class="section-number">6.3 </span>TOmniCounter</a>
      </li>
      <li>
        <a href='chap09.html#misc-TOmniAlignedInt32'><span class="section-number">6.4 </span>TOmniAlignedInt32 and TOmniAlignedInt64</a>
      </li>
      <li>
        <a href='chap09.html#misc-tomnirecordwrapper'><span class="section-number">6.5 </span>TOmniRecordWrapper</a>
      </li>
      <li>
        <a href='chap09.html#misc-tomnirecord'><span class="section-number">6.6 </span>TOmniRecord</a>
      </li>
      <li>
        <a href='chap09.html#misc-iomniautodestroyobject'><span class="section-number">6.7 </span>IOmniAutoDestroyObject</a>
      </li>
      <li>
        <a href='chap09.html#misc-iomniintegerset'><span class="section-number">6.8 </span>IOmniIntegerSet</a>
      </li>
      <li>
        <a href='chap09.html#misc-environment'><span class="section-number">6.9 </span>Environment</a>
        <ul>
          <li>
            <a href='chap09.html#leanpub-auto-iomniaffinity'><span class="section-number">6.9.1 </span>IOmniAffinity</a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap10.html#howto'><span class="section-number">7. </span>How-to</a>
    <ul>
      <li>
        <a href='chap10.html#howto-backgroundFileScanning'><span class="section-number">7.1 </span>Background file scanning</a>
      </li>
      <li>
        <a href='chap10.html#howto-webDownload'><span class="section-number">7.2 </span>Web download and database storage</a>
      </li>
      <li>
        <a href='chap10.html#howto-parallelForSyncOut'><span class="section-number">7.3 </span>Parallel for with synchronized output</a>
      </li>
      <li>
        <a href='chap10.html#howto-parallelForTaskInit'><span class="section-number">7.4 </span>Using taskIndex and task initializer in parallel for</a>
      </li>
      <li>
        <a href='chap10.html#howto-listPartitioning'><span class="section-number">7.5 </span>Background worker and list partitioning</a>
      </li>
      <li>
        <a href='chap10.html#howto-parallelDataProduction'><span class="section-number">7.6 </span>Parallel data production</a>
      </li>
      <li>
        <a href='chap10.html#howto-connectionPool'><span class="section-number">7.7 </span>Building a connection pool</a>
        <ul>
          <li>
            <a href='chap10.html#leanpub-auto-from-theory-to-practice'><span class="section-number">7.7.1 </span>From theory to practice</a>
          </li>
          <li>
            <a href='chap10.html#leanpub-auto-running-the-demo'><span class="section-number">7.7.2 </span>Running the demo</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap10.html#howto-quickSortParallelMax'><span class="section-number">7.8 </span>QuickSort and parallel max</a>
        <ul>
          <li>
            <a href='chap10.html#leanpub-auto-quicksort'><span class="section-number">7.8.1 </span>QuickSort</a>
          </li>
          <li>
            <a href='chap10.html#leanpub-auto-parallel-max'><span class="section-number">7.8.2 </span>Parallel max</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap10.html#howto-parallelSearch'><span class="section-number">7.9 </span>Parallel search in a tree</a>
      </li>
      <li>
        <a href='chap10.html#howto-multiFrame'><span class="section-number">7.10 </span>Multiple workers with multiple frames</a>
        <ul>
          <li>
            <a href='chap10.html#leanpub-auto-the-worker'><span class="section-number">7.10.1 </span>The worker</a>
          </li>
          <li>
            <a href='chap10.html#leanpub-auto-the-frame'><span class="section-number">7.10.2 </span>The frame</a>
          </li>
          <li>
            <a href='chap10.html#leanpub-auto-the-form'><span class="section-number">7.10.3 </span>The form</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap10.html#howto-databases'><span class="section-number">7.11 </span>OmniThreadLibrary and databases</a>
        <ul>
          <li>
            <a href='chap10.html#leanpub-auto-database-model'><span class="section-number">7.11.1 </span>Database model</a>
          </li>
          <li>
            <a href='chap10.html#leanpub-auto-frame-and-worker'><span class="section-number">7.11.2 </span>Frame and worker</a>
            <ul>
              <li>
                <a href='chap10.html#leanpub-auto-connecting-to-the-database'><span class="section-number">7.11.2.1 </span>Connecting to the database</a>
              </li>
              <li>
                <a href='chap10.html#leanpub-auto-retrieving-the-data'><span class="section-number">7.11.2.2 </span>Retrieving the data</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap10.html#leanpub-auto-main-program'><span class="section-number">7.11.3 </span>Main program</a>
          </li>
        </ul>
      </li>
      <li>
        <a href='chap10.html#howto-com'><span class="section-number">7.12 </span>OmniThreadLibrary and COM/OLE</a>
      </li>
      <li>
        <a href='chap10.html#howto-mqtthread'><span class="section-number">7.13 </span>Using a message queue with a TThread worker</a>
        <ul>
          <li>
            <a href='chap10.html#leanpub-auto-sending-data-from-multiple-producers-to-a-single-worker'><span class="section-number">7.13.1 </span>Sending data from multiple producers to a single worker</a>
            <ul>
              <li>
                <a href='chap10.html#leanpub-auto-initialization-and-cleanup'><span class="section-number">7.13.1.1 </span>Initialization and cleanup</a>
              </li>
              <li>
                <a href='chap10.html#leanpub-auto-sending-data-to-the-worker'><span class="section-number">7.13.1.2 </span>Sending data to the worker</a>
              </li>
              <li>
                <a href='chap10.html#leanpub-auto-receiving-the-data'><span class="section-number">7.13.1.3 </span>Receiving the data</a>
              </li>
            </ul>
          </li>
          <li>
            <a href='chap10.html#leanpub-auto-sending-data-from-a-worker-to-a-form'><span class="section-number">7.13.2 </span>Sending data from a worker to a form</a>
            <ul>
              <li>
                <a href='chap10.html#leanpub-auto-initialization-and-cleanup-1'><span class="section-number">7.13.2.1 </span>Initialization and cleanup</a>
              </li>
              <li>
                <a href='chap10.html#leanpub-auto-sending-data-to-the-form'><span class="section-number">7.13.2.2 </span>Sending data to the form</a>
              </li>
              <li>
                <a href='chap10.html#leanpub-auto-receiving-the-data-1'><span class="section-number">7.13.2.3 </span>Receiving the data</a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap11.html#appendix-units'>A. Units</a>
  </li>
  <li>
    <a href='chap12.html#demos'>B. Demo applications</a>
  </li>
  <li>
    <a href='chap13.html#examples'>C. Examples</a>
  </li>
  <li>
    <a href='chap14.html#appendix-hooking'>D. Hooking into OmniThreadLibrary</a>
    <ul>
      <li>
        <a href='chap14.html#leanpub-auto-exception-notifications'>Exception notifications</a>
      </li>
      <li>
        <a href='chap14.html#leanpub-auto-thread-notifications'>Thread notifications</a>
      </li>
      <li>
        <a href='chap14.html#leanpub-auto-pool-notifications'>Pool notifications</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap15.html#highlevel-foreach-internals'>E. ForEach internals</a>
    <ul>
      <li>
        <a href='chap15.html#leanpub-auto-source-provider'>Source provider</a>
      </li>
      <li>
        <a href='chap15.html#leanpub-auto-data-manager'>Data manager</a>
      </li>
      <li>
        <a href='chap15.html#leanpub-auto-local-queue'>Local queue</a>
      </li>
      <li>
        <a href='chap15.html#leanpub-auto-output-ordering'>Output ordering</a>
      </li>
    </ul>
  </li>
  <li>
    <a href='chap16.html#leanpub-auto-f-hyperlinks'>F. Hyperlinks</a>
  </li>
  <li>
    <a href='chap17.html#leanpub-endnotes'>Notes</a>
  </li>
</ul>

</ol>
</div>
<div id="leanpub-main" class="kramdown">
<h2 id="misc">
<span class="section-number">6. </span>Miscellaneous</h2>

<p>This chapter covers some OmniThreadLibrary classes, records, and interfaces, that are useful for everyday programming but somehow did not find place in any other chapter.</p>


<h3 id="misc-tOmniTwoWayChannel">
<span class="section-number">6.1 </span>TOmniTwoWayChannel</h3>

<p>The <em>OtlComm</em> unit implements a <code>TOmniTwoWayChannel</code> class with a corresponding <code>IOmniTwoWayChannel</code> interface, which defines a bidirectional communication channel. This channel consists of two unidirectional channels, which are exposed through two <a href="chap07.html#lowlevel-communication"><code>IOmniCommunicationEndpoint</code></a> interfaces.</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno"> 1 </code><code class="k">type</code>
<code class="lineno"> 2 </code>  <code class="n">IOmniTwoWayChannel</code> <code class="o">=</code> <code class="k">interface</code> <code class="p">[</code><code class="s">'{3ED1AB88-4209-4E01-AA79-A577AD719520}'</code><code class="p">]</code>
<code class="lineno"> 3 </code>    <code class="k">function</code> <code class="nf">Endpoint1</code><code class="o">:</code> <code class="n">IOmniCommunicationEndpoint</code><code class="o">;</code>
<code class="lineno"> 4 </code>    <code class="k">function</code> <code class="nf">Endpoint2</code><code class="o">:</code> <code class="n">IOmniCommunicationEndpoint</code><code class="o">;</code>
<code class="lineno"> 5 </code>  <code class="k">end</code><code class="o">;</code>
<code class="lineno"> 6 </code>  
<code class="lineno"> 7 </code>  <code class="n">TOmniTwoWayChannel</code> <code class="o">=</code> <code class="k">class</code><code class="p">(</code><code class="n">TInterfacedObject</code><code class="o">,</code> <code class="n">IOmniTwoWayChannel</code><code class="p">)</code>
<code class="lineno"> 8 </code>    <code class="k">constructor</code> <code class="nf">Create</code><code class="p">(</code><code class="n">messageQueueSize</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code> <code class="n">taskTerminatedEvent</code><code class="o">:</code> <code class="kt">THandle</code><code class="p">)</code><code class="o">;</code>
<code class="lineno"> 9 </code>    <code class="k">destructor</code>  <code class="nf">Destroy</code><code class="o">;</code> <code class="kp">override</code><code class="o">;</code>
<code class="lineno">10 </code>    <code class="k">function</code> <code class="nf">Endpoint1</code><code class="o">:</code> <code class="n">IOmniCommunicationEndpoint</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">11 </code>    <code class="k">function</code> <code class="nf">Endpoint2</code><code class="o">:</code> <code class="n">IOmniCommunicationEndpoint</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">12 </code>  <code class="k">end</code><code class="o">;</code> 
<code class="lineno">13 </code>
<code class="lineno">14 </code>  <code class="k">function</code> <code class="nf">CreateTwoWayChannel</code><code class="p">(</code><code class="n">numElements</code><code class="o">:</code> <code class="kt">integer</code> <code class="o">=</code> <code class="n">CDefaultQueueSize</code><code class="o">;</code>
<code class="lineno">15 </code>    <code class="n">taskTerminatedEvent</code><code class="o">:</code> <code class="kt">THandle</code> <code class="o">=</code> <code class="mi">0</code><code class="p">)</code><code class="o">:</code> <code class="n">IOmniTwoWayChannel</code><code class="o">;</code>
</pre></div>

</figure>

<p>This interface is used internally for <em>task controller</em>/<em>task</em> communication, but can be also used in your own code.</p>

<p>One side on communication should use <code>Endpoint1</code> endpoint and its <code>Send</code>/ <code>Receive</code> methods while the other side should use the <code>Endpoint2</code> endpoint and its <code>Send</code>/<code>Receive</code> methods. Whatever is sent to <code>Endpoint1</code> can be received on <code>Endpoint2</code> and whatever is sent to <code>Endpoin2</code> can be received on <code>Endpoint1</code>.</p>

<p>
  <em>See also: <code>RegisterComm</code>/<code>UnregisterComm</code> in sections <a href="chap07.html#lowlevel-tomniworker-registercomm"><code>RegisterComm</code></a> and <a href="chap07.html#lowlevel-iomnitask"><code>IOmniTask</code> interface</a>. Another example can be found in the <code>8_RegisterComm</code> <a href="chap12.html#demos">demo</a>.</em>
</p>


<h3 id="misc-tomnivaluecontainer">
<span class="section-number">6.2 </span>TOmniValueContainer</h3>

<p>The <code>TOmniValueContainer</code> class implements a growable list of <a href="chap05.html#introotl-tomnivalue"><code>TOmniValue</code></a> values, indexed with an integer and string values. It is used internally in the <a href="chap05.html#introotl-tomnivalue-array"><code>TOmniValue.AsArray</code></a> and for <a href="chap07.html#lowlevel-simpletasks-parameters">task parameter passing</a>.</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno"> 1 </code><code class="k">type</code>
<code class="lineno"> 2 </code>  <code class="n">TOmniValueContainer</code> <code class="o">=</code> <code class="k">class</code>
<code class="lineno"> 3 </code>  <code class="kp">public</code>
<code class="lineno"> 4 </code>    <code class="k">constructor</code> <code class="nf">Create</code><code class="o">;</code>
<code class="lineno"> 5 </code>    <code class="k">procedure</code> <code class="nf">Add</code><code class="p">(</code><code class="k">const</code> <code class="n">paramValue</code><code class="o">:</code> <code class="n">TOmniValue</code><code class="o">;</code> <code class="n">paramName</code><code class="o">:</code> <code class="k">string</code> <code class="o">=</code> <code class="s">''</code><code class="p">)</code><code class="o">;</code>
<code class="lineno"> 6 </code>    <code class="k">procedure</code> <code class="nf">Assign</code><code class="p">(</code><code class="k">const</code> <code class="n">parameters</code><code class="o">:</code> <code class="k">array</code> <code class="k">of</code> <code class="n">TOmniValue</code><code class="p">)</code><code class="o">;</code>
<code class="lineno"> 7 </code>    <code class="k">procedure</code> <code class="nf">AssignNamed</code><code class="p">(</code><code class="k">const</code> <code class="n">parameters</code><code class="o">:</code> <code class="k">array</code> <code class="k">of</code> <code class="n">TOmniValue</code><code class="p">)</code><code class="o">;</code>
<code class="lineno"> 8 </code>    <code class="k">function</code>  <code class="nf">ByName</code><code class="p">(</code><code class="k">const</code> <code class="n">paramName</code><code class="o">:</code> <code class="k">string</code><code class="p">)</code><code class="o">:</code> <code class="n">TOmniValue</code><code class="o">;</code> <code class="n">overload</code><code class="o">;</code>
<code class="lineno"> 9 </code>    <code class="k">function</code>  <code class="nf">ByName</code><code class="p">(</code><code class="k">const</code> <code class="n">paramName</code><code class="o">:</code> <code class="k">string</code><code class="o">;</code> 
<code class="lineno">10 </code>      <code class="k">const</code> <code class="n">defValue</code><code class="o">:</code> <code class="n">TOmniValue</code><code class="p">)</code><code class="o">:</code> <code class="n">TOmniValue</code><code class="o">;</code> <code class="n">overload</code><code class="o">;</code>
<code class="lineno">11 </code>    <code class="k">function</code>  <code class="nf">Count</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code>
<code class="lineno">12 </code>    <code class="k">function</code>  <code class="nf">Exists</code><code class="p">(</code><code class="k">const</code> <code class="n">paramName</code><code class="o">:</code> <code class="k">string</code><code class="p">)</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code>
<code class="lineno">13 </code>    <code class="k">function</code>  <code class="nf">IndexOf</code><code class="p">(</code><code class="k">const</code> <code class="n">paramName</code><code class="o">:</code> <code class="k">string</code><code class="p">)</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code>
<code class="lineno">14 </code>    <code class="k">procedure</code> <code class="nf">Insert</code><code class="p">(</code><code class="n">paramIdx</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code> <code class="k">const</code> <code class="n">value</code><code class="o">:</code> <code class="n">TOmniValue</code><code class="p">)</code><code class="o">;</code>
<code class="lineno">15 </code>    <code class="k">function</code>  <code class="nf">IsLocked</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">16 </code>    <code class="k">procedure</code> <code class="nf">Lock</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">17 </code>    <code class="k">property</code> <code class="py">Item</code><code class="p">[</code><code class="n">paramIdx</code><code class="o">:</code> <code class="kt">integer</code><code class="p">]</code><code class="o">:</code> <code class="n">TOmniValue</code> <code class="kp">read</code> <code class="nf">GetItem</code> <code class="kp">write</code> <code class="nf">SetItem</code><code class="o">;</code> <code class="kp">default</code><code class="o">;</code>
<code class="lineno">18 </code>    <code class="k">property</code> <code class="py">Item</code><code class="p">[</code><code class="k">const</code> <code class="n">paramName</code><code class="o">:</code> <code class="k">string</code><code class="p">]</code><code class="o">:</code> <code class="n">TOmniValue</code> <code class="kp">read</code> <code class="nf">GetItem</code> <code class="kp">write</code> <code class="nf">SetItem</code><code class="o">;</code> <code class="kp">default</code><code class="o">;</code>
<code class="lineno">19 </code>    <code class="k">property</code> <code class="py">Item</code><code class="p">[</code><code class="k">const</code> <code class="n">param</code><code class="o">:</code> <code class="n">TOmniValue</code><code class="p">]</code><code class="o">:</code> <code class="n">TOmniValue</code> <code class="kp">read</code> <code class="nf">GetItem</code> <code class="kp">write</code> <code class="nf">SetItem</code><code class="o">;</code> <code class="kp">default</code><code class="o">;</code>
<code class="lineno">20 </code>  <code class="k">end</code><code class="o">;</code>
</pre></div>

</figure>

<p><code>Add</code> adds a new value to the list. Index can be an integer value (starting with <em>0</em>) or a string value. This method will raise an exception if the container is <em>locked</em> (see below).</p>

<p><code>Assign</code> assigns an array of <code>TOmniValue</code>s to the container. Previous values stored in the container are lost (see the example for <a href="chap05.html#introotl-tomnivalue-array"><code>TOmniValue.CreateNamed</code></a> for more information). This method will raise an exception if the container is <em>locked</em> (see below).</p>

<p><code>AssignNamed</code> assigns an array of named values to the container. Elements of the array must alternate between names (string indexes) and values. Previous values stored in the container are lost. This method will raise an exception if the container is <em>locked</em> (see below).</p>

<p><code>ByName</code> searches for a value with the specified name and returns the value. Searching is linear. Because of that, <code>TOmniValueContainer</code> should not be used to store large quantity of string-indexed data. One version of the function returns <a href="chap05.html#introotl-tomnivalue-clearing"><code>TOmniValue.Null</code></a> if the string key is not found, while the other returns the default value, passed to the function call.</p>

<p><code>Count</code> returns the current size of the container.</p>

<p><code>Exists</code> checks whether a string-indexed value with the specified name is stored in the container.</p>

<p><code>IndexOf</code> returns an integer index associated with the string-indexed value. This index can be used to access the value in the container. If the value is not found, the function returns <em>-1</em>.</p>

<p><code>Insert</code> inserts the new value into an integer-indexed array. This method will raise an exception if the container is <em>locked</em> (see below).</p>

<p><code>IsLocked</code> checks where the container is <em>locked</em>. Locked container will not accept new values.</p>

<p><code>Lock</code> <em>locks</em> the container. That prevents the code from changing the container. From that point, values can only be read from the container, not written to. A container cannot be unlocked.</p>

<p><code>Item</code> property accesses a specific value either by an integer index (from <em>0</em> to <code>Count-1</code>), or by string index. If a <code>TOmniValue</code> is passed as an index, the type of the <code>TOmniValue</code> index parameter will determine how the container is accessed.</p>


<h3 id="misc-tomnicounter">
<span class="section-number">6.3 </span>TOmniCounter</h3>

<p>The <code>CreateCounter</code> (<em>OtlCommon</em> unit) function creates a counter with an atomic increment and decrement operations. Such counter can be used from multiple threads at the same time with no locking. Accessing the counter’s value is also thread-safe.</p>

<p>The counter is returned as an <code>IOmniCounter</code> interface. It is implemented by the <code>TOmniCounter</code> class, which you can use in your code directly if you’d rather deal with objects than interfaces.</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno"> 1 </code><code class="k">type</code>
<code class="lineno"> 2 </code>  <code class="n">IOmniCounter</code> <code class="o">=</code> <code class="k">interface</code>
<code class="lineno"> 3 </code>    <code class="k">function</code>  <code class="nf">Increment</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code>
<code class="lineno"> 4 </code>    <code class="k">function</code>  <code class="nf">Decrement</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code>
<code class="lineno"> 5 </code>    <code class="k">function</code>  <code class="nf">Take</code><code class="p">(</code><code class="n">count</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code> <code class="n">overload</code><code class="o">;</code>
<code class="lineno"> 6 </code>    <code class="k">function</code>  <code class="nf">Take</code><code class="p">(</code><code class="n">count</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code> <code class="k">var</code> <code class="n">taken</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code> <code class="n">overload</code><code class="o">;</code>
<code class="lineno"> 7 </code>    <code class="k">property</code> <code class="py">Value</code><code class="o">:</code> <code class="kt">integer</code> <code class="kp">read</code> <code class="nf">GetValue</code> <code class="kp">write</code> <code class="nf">SetValue</code><code class="o">;</code>
<code class="lineno"> 8 </code>  <code class="k">end</code><code class="o">;</code> 
<code class="lineno"> 9 </code>
<code class="lineno">10 </code>  <code class="n">TOmniCounter</code> <code class="o">=</code> <code class="k">record</code>
<code class="lineno">11 </code>    <code class="k">procedure</code> <code class="nf">Initialize</code><code class="o">;</code>
<code class="lineno">12 </code>    <code class="k">function</code>  <code class="nf">Increment</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code>
<code class="lineno">13 </code>    <code class="k">function</code>  <code class="nf">Decrement</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code>
<code class="lineno">14 </code>    <code class="k">function</code>  <code class="nf">Take</code><code class="p">(</code><code class="n">count</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code> <code class="n">overload</code><code class="o">;</code>
<code class="lineno">15 </code>    <code class="k">function</code>  <code class="nf">Take</code><code class="p">(</code><code class="n">count</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code> <code class="k">var</code> <code class="n">taken</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code> <code class="n">overload</code><code class="o">;</code>
<code class="lineno">16 </code>    <code class="k">property</code> <code class="py">Value</code><code class="o">:</code> <code class="kt">integer</code> <code class="kp">read</code> <code class="nf">GetValue</code> <code class="kp">write</code> <code class="nf">SetValue</code><code class="o">;</code>
<code class="lineno">17 </code>  <code class="k">end</code><code class="o">;</code>
<code class="lineno">18 </code>  
<code class="lineno">19 </code>  <code class="k">function</code>  <code class="nf">CreateCounter</code><code class="p">(</code><code class="n">initialValue</code><code class="o">:</code> <code class="kt">integer</code> <code class="o">=</code> <code class="mi">0</code><code class="p">)</code><code class="o">:</code> <code class="n">IOmniCounter</code><code class="o">;</code>
</pre></div>

</figure>

<p>The counter part of the <code>TOmniCounter</code> record is automatically initialized on the first use. If you want, you can call <code>Initialize</code> in advance, although that is not required.</p>

<p><code>Take</code> is a special operation which tries to decrement the counter by <code>count</code> but stops at <em>0</em>. It returns the number that could be <em>taken</em> from the counter (basically, <code>Min(count, counter.Value)</code>). Its effect is the same as the following code (except that the real implementation of <code>Take</code> is thread-safe).</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno">1 </code><code class="bp">Result</code> <code class="o">:=</code> <code class="nb">Min</code><code class="p">(</code><code class="n">counter</code><code class="o">,</code> <code class="n">count</code><code class="p">)</code><code class="o">;</code>
<code class="lineno">2 </code><code class="n">counter</code> <code class="o">:=</code> <code class="n">counter</code> <code class="o">-</code> <code class="bp">Result</code><code class="o">;</code>
</pre></div>

</figure>

<p><code>Take</code> is used in demo <a href="chap10.html#howto-parallelDataProduction"><em>Parallel Data Production</em></a>.</p>


<h3 id="misc-TOmniAlignedInt32">
<span class="section-number">6.4 </span>TOmniAlignedInt32 and TOmniAlignedInt64</h3>

<p>Those two records hold <em>4</em>-byte (<em>32</em> bit) and <em>8</em>-byte (<em>64</em> bit) values, respectively. These values are suitably aligned so they can be read from and written to in an atomic operation. They also implement atomic <code>Increment</code>, <code>Decrement</code>, <code>Add</code>, and <code>Substract</code> operations.</p>

<aside class="information blurb">
    <p>These two types were added in version <sup>[3.06]</sup>. Previously, OmniThreadLibrary used functionally equivalent types <code>TGp4AlignedInt</code> and <code>TGp8AlignedInt64</code> from the <em>GpStuff</em> unit.   </p>

</aside>

<p>Reading and writing values stored in the record (through the <code>Value</code> property or by using a supplied <code>Implicit</code> operator) is also atomic on the Win64 platform.</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno"> 1 </code><code class="k">type</code>
<code class="lineno"> 2 </code>  <code class="n">TOmniAlignedInt32</code> <code class="o">=</code> <code class="k">record</code>
<code class="lineno"> 3 </code>  <code class="kp">public</code>
<code class="lineno"> 4 </code>    <code class="k">procedure</code> <code class="nf">Initialize</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno"> 5 </code>    <code class="k">function</code>  <code class="nf">Add</code><code class="p">(</code><code class="n">value</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno"> 6 </code>    <code class="k">function</code>  <code class="nf">Addr</code><code class="o">:</code> <code class="kt">PInteger</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno"> 7 </code>    <code class="k">function</code>  <code class="nf">CAS</code><code class="p">(</code><code class="n">oldValue</code><code class="o">,</code> <code class="n">newValue</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code>
<code class="lineno"> 8 </code>    <code class="k">function</code>  <code class="nf">Decrement</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code> <code class="n">overload</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno"> 9 </code>    <code class="k">function</code>  <code class="nf">Decrement</code><code class="p">(</code><code class="n">value</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code> <code class="n">overload</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">10 </code>    <code class="k">function</code>  <code class="nf">Increment</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code> <code class="n">overload</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">11 </code>    <code class="k">function</code>  <code class="nf">Increment</code><code class="p">(</code><code class="n">value</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code> <code class="n">overload</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">12 </code>    <code class="k">function</code>  <code class="nf">Subtract</code><code class="p">(</code><code class="n">value</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">13 </code>    <code class="k">class</code> <code class="k">operator</code> <code class="nf">Add</code><code class="p">(</code><code class="k">const</code> <code class="n">ai</code><code class="o">:</code> <code class="n">TOmniAlignedInt32</code><code class="o">;</code> <code class="n">i</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">cardinal</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">14 </code>    <code class="k">class</code> <code class="k">operator</code> <code class="nf">Equal</code><code class="p">(</code><code class="k">const</code> <code class="n">ai</code><code class="o">:</code> <code class="n">TOmniAlignedInt32</code><code class="o">;</code> <code class="n">i</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">15 </code>    <code class="k">class</code> <code class="k">operator</code> <code class="nf">GreaterThan</code><code class="p">(</code><code class="k">const</code> <code class="n">ai</code><code class="o">:</code> <code class="n">TOmniAlignedInt32</code><code class="o">;</code> <code class="n">i</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">16 </code>    <code class="k">class</code> <code class="k">operator</code> <code class="nf">GreaterThanOrEqual</code><code class="p">(</code><code class="k">const</code> <code class="n">ai</code><code class="o">:</code> <code class="n">TOmniAlignedInt32</code><code class="o">;</code> <code class="n">i</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code> 
<code class="lineno">17 </code>      <code class="k">inline</code><code class="o">;</code>
<code class="lineno">18 </code>    <code class="k">class</code> <code class="k">operator</code> <code class="nf">Implicit</code><code class="p">(</code><code class="k">const</code> <code class="n">ai</code><code class="o">:</code> <code class="n">TOmniAlignedInt32</code><code class="p">)</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">19 </code>    <code class="k">class</code> <code class="k">operator</code> <code class="nf">Implicit</code><code class="p">(</code><code class="k">const</code> <code class="n">ai</code><code class="o">:</code> <code class="n">TOmniAlignedInt32</code><code class="p">)</code><code class="o">:</code> <code class="kt">cardinal</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">20 </code>    <code class="k">class</code> <code class="k">operator</code> <code class="nf">Implicit</code><code class="p">(</code><code class="k">const</code> <code class="n">ai</code><code class="o">:</code> <code class="n">TOmniAlignedInt32</code><code class="p">)</code><code class="o">:</code> <code class="kt">PInteger</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">21 </code>    <code class="k">class</code> <code class="k">operator</code> <code class="nf">LessThan</code><code class="p">(</code><code class="k">const</code> <code class="n">ai</code><code class="o">:</code> <code class="n">TOmniAlignedInt32</code><code class="o">;</code> <code class="n">i</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">22 </code>    <code class="k">class</code> <code class="k">operator</code> <code class="nf">LessThanOrEqual</code><code class="p">(</code><code class="k">const</code> <code class="n">ai</code><code class="o">:</code> <code class="n">TOmniAlignedInt32</code><code class="o">;</code> <code class="n">i</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code> 
<code class="lineno">23 </code>      <code class="k">inline</code><code class="o">;</code>
<code class="lineno">24 </code>    <code class="k">class</code> <code class="k">operator</code> <code class="nf">NotEqual</code><code class="p">(</code><code class="k">const</code> <code class="n">ai</code><code class="o">:</code> <code class="n">TOmniAlignedInt32</code><code class="o">;</code> <code class="n">i</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">25 </code>    <code class="k">class</code> <code class="k">operator</code> <code class="nf">Subtract</code><code class="p">(</code><code class="n">ai</code><code class="o">:</code> <code class="n">TOmniAlignedInt32</code><code class="o">;</code> <code class="n">i</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">cardinal</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">26 </code>    <code class="k">property</code> <code class="py">Value</code><code class="o">:</code> <code class="kt">integer</code> <code class="kp">read</code> <code class="nf">GetValue</code> <code class="kp">write</code> <code class="nf">SetValue</code><code class="o">;</code>
<code class="lineno">27 </code>  <code class="k">end</code><code class="o">;</code> 
<code class="lineno">28 </code>
<code class="lineno">29 </code>  <code class="n">TOmniAlignedInt64</code> <code class="o">=</code> <code class="k">record</code>
<code class="lineno">30 </code>  <code class="kp">public</code>
<code class="lineno">31 </code>    <code class="k">procedure</code> <code class="nf">Initialize</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">32 </code>    <code class="k">function</code>  <code class="nf">Add</code><code class="p">(</code><code class="n">value</code><code class="o">:</code> <code class="kt">int64</code><code class="p">)</code><code class="o">:</code> <code class="kt">int64</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">33 </code>    <code class="k">function</code>  <code class="nf">Addr</code><code class="o">:</code> <code class="kt">PInt64</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">34 </code>    <code class="k">function</code>  <code class="nf">CAS</code><code class="p">(</code><code class="n">oldValue</code><code class="o">,</code> <code class="n">newValue</code><code class="o">:</code> <code class="kt">int64</code><code class="p">)</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code>
<code class="lineno">35 </code>    <code class="k">function</code>  <code class="nf">Decrement</code><code class="o">:</code> <code class="kt">int64</code><code class="o">;</code> <code class="n">overload</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">36 </code>    <code class="k">function</code>  <code class="nf">Decrement</code><code class="p">(</code><code class="n">value</code><code class="o">:</code> <code class="kt">int64</code><code class="p">)</code><code class="o">:</code> <code class="kt">int64</code><code class="o">;</code> <code class="n">overload</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">37 </code>    <code class="k">function</code>  <code class="nf">Increment</code><code class="o">:</code> <code class="kt">int64</code><code class="o">;</code> <code class="n">overload</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">38 </code>    <code class="k">function</code>  <code class="nf">Increment</code><code class="p">(</code><code class="n">value</code><code class="o">:</code> <code class="kt">int64</code><code class="p">)</code><code class="o">:</code> <code class="kt">int64</code><code class="o">;</code> <code class="n">overload</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">39 </code>    <code class="k">function</code>  <code class="nf">Subtract</code><code class="p">(</code><code class="n">value</code><code class="o">:</code> <code class="kt">int64</code><code class="p">)</code><code class="o">:</code> <code class="kt">int64</code><code class="o">;</code> <code class="k">inline</code><code class="o">;</code>
<code class="lineno">40 </code>    <code class="k">property</code> <code class="py">Value</code><code class="o">:</code> <code class="kt">int64</code> <code class="kp">read</code> <code class="nf">GetValue</code> <code class="kp">write</code> <code class="nf">SetValue</code><code class="o">;</code>
<code class="lineno">41 </code>  <code class="k">end</code><code class="o">;</code>
</pre></div>

</figure>


<h3 id="misc-tomnirecordwrapper">
<span class="section-number">6.5 </span>TOmniRecordWrapper</h3>

<p>The <code>TOmniRecordWrapper&lt;T&gt;</code> class allows you to <em>wrap</em> any record inside an instance of a class. </p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno">1 </code><code class="k">type</code>
<code class="lineno">2 </code>  <code class="n">TOmniRecordWrapper</code><code class="o">&lt;</code><code class="n">T</code><code class="o">&gt;</code> <code class="o">=</code> <code class="k">class</code>
<code class="lineno">3 </code>  <code class="kp">public</code>
<code class="lineno">4 </code>    <code class="k">constructor</code> <code class="nf">Create</code><code class="p">(</code><code class="k">const</code> <code class="n">value</code><code class="o">:</code> <code class="n">T</code><code class="p">)</code><code class="o">;</code>
<code class="lineno">5 </code>    <code class="k">function</code>  <code class="nf">GetRecord</code><code class="o">:</code> <code class="n">T</code><code class="o">;</code>
<code class="lineno">6 </code>    <code class="k">procedure</code> <code class="nf">SetRecord</code><code class="p">(</code><code class="k">const</code> <code class="n">value</code><code class="o">:</code> <code class="n">T</code><code class="p">)</code><code class="o">;</code>
<code class="lineno">7 </code>    <code class="k">property</code> <code class="py">Value</code><code class="o">:</code> <code class="n">T</code> <code class="kp">read</code> <code class="nf">GetRecord</code> <code class="kp">write</code> <code class="nf">SetRecord</code><code class="o">;</code>
<code class="lineno">8 </code>  <code class="k">end</code><code class="o">;</code>
</pre></div>

</figure>

<p>You can then use the resulting object in situations where an object is expected (for example, you can store such an object in a <code>TObjectList</code>).</p>

<p>This class is used in <a href="chap05.html#introotl-tomnivalue-records"><code>TOmniValue</code></a> to implement functions <code>FromRecord&lt;T&gt;</code> and <code>ToRecord&lt;T&gt;</code>.</p>


<h3 id="misc-tomnirecord">
<span class="section-number">6.6 </span>TOmniRecord</h3>

<p>The <code>TOmniRecord&lt;T&gt;</code> record allows you to <em>wrap</em> any value inside a record type.</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno">1 </code><code class="k">type</code>
<code class="lineno">2 </code>  <code class="n">TOmniRecord</code><code class="o">&lt;</code><code class="n">T</code><code class="o">&gt;</code> <code class="o">=</code> <code class="k">record</code>
<code class="lineno">3 </code>  <code class="n">strict</code> <code class="kp">private</code>
<code class="lineno">4 </code>    <code class="n">FValue</code><code class="o">:</code> <code class="n">T</code><code class="o">;</code>
<code class="lineno">5 </code>  <code class="kp">public</code>
<code class="lineno">6 </code>    <code class="k">constructor</code> <code class="nf">Create</code><code class="p">(</code><code class="k">const</code> <code class="n">aValue</code><code class="o">:</code> <code class="n">T</code><code class="p">)</code><code class="o">;</code>
<code class="lineno">7 </code>    <code class="k">property</code> <code class="py">Value</code><code class="o">:</code> <code class="n">T</code> <code class="kp">read</code> <code class="nf">FValue</code> <code class="kp">write</code> <code class="nf">FValue</code><code class="o">;</code>
<code class="lineno">8 </code>  <code class="k">end</code><code class="o">;</code>
</pre></div>

</figure>


<h3 id="misc-iomniautodestroyobject">
<span class="section-number">6.7 </span>IOmniAutoDestroyObject</h3>

<p>You can use the <code>CreateAutoDestroyObject</code> function (<em>OtlCommon</em> unit) to wrap any object into an <code>IOmniAutoDestroyObject</code> interface.</p>

<p>When this interface’s reference count drops to <em>0</em>, it automatically destroys the wrapped object.</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno">1 </code><code class="k">type</code>
<code class="lineno">2 </code>  <code class="n">IOmniAutoDestroyObject</code> <code class="o">=</code> <code class="k">interface</code>
<code class="lineno">3 </code>    <code class="k">property</code> <code class="py">Value</code><code class="o">:</code> <code class="kt">TObject</code> <code class="kp">read</code> <code class="nf">GetValue</code><code class="o">;</code>
<code class="lineno">4 </code>  <code class="k">end</code><code class="o">;</code>
<code class="lineno">5 </code>  
<code class="lineno">6 </code>  <code class="k">function</code>  <code class="nf">CreateAutoDestroyObject</code><code class="p">(</code><code class="n">obj</code><code class="o">:</code> <code class="kt">TObject</code><code class="p">)</code><code class="o">:</code> <code class="n">IOmniAutoDestroyObject</code><code class="o">;</code>
</pre></div>

</figure>

<p>Original object can be accessed through the <code>Value</code> property.</p>


<h3 id="misc-iomniintegerset">
<span class="section-number">6.8 </span>IOmniIntegerSet</h3>

<p>The <code>IOmniIntegerSet</code> interface and it’s implementing class <code>TOmniIntegerSet</code> <sup>[3.06]</sup> can be used to store a set of integers. They are defined in the <em>OtlCommon</em> unit.</p>

<p>The big difference between the Delphi built-in <code>set</code> type and <code>IOmniIntegerSet</code> is that the latter can store more than 256 elements and that they are not limited in size. Delphi’s <code>set</code> is, on the other hand, faster and supports set operations (union, intersection, difference).</p>

<aside class="information blurb">
    <p>Data is stored in a very wasteful manner as a TArray&lt;boolean&gt;. The higher bound of this array is equal to the largest number stored in the set so <code>IOmniIntegerSet</code> shouldn’t be used for storing large integers. <code>IOmniIntegerSet</code> was created to store processor affinity values in the <a href="chap09.html#misc-environment"><code>Environment</code></a> object and its implementation is optimized for this purpose.     </p>

</aside>

<p><code>IOmniIntegerSet</code> cannot store negative values.</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno"> 1 </code><code class="k">type</code>
<code class="lineno"> 2 </code>  <code class="n">TOmniIntegerSetChangedEvent</code> <code class="o">=</code> <code class="k">procedure</code><code class="p">(</code><code class="k">const</code> <code class="n">intSet</code><code class="o">:</code> <code class="n">IOmniIntegerSet</code><code class="p">)</code> <code class="k">of</code> <code class="k">object</code><code class="o">;</code>
<code class="lineno"> 3 </code>  
<code class="lineno"> 4 </code>  <code class="n">IOmniIntegerSet</code> <code class="o">=</code> <code class="k">interface</code>
<code class="lineno"> 5 </code>    <code class="k">function</code>  <code class="nf">Add</code><code class="p">(</code><code class="n">value</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code>
<code class="lineno"> 6 </code>    <code class="k">procedure</code> <code class="nf">Assign</code><code class="p">(</code><code class="k">const</code> <code class="n">value</code><code class="o">:</code> <code class="n">IOmniIntegerSet</code><code class="p">)</code><code class="o">;</code>
<code class="lineno"> 7 </code>    <code class="k">procedure</code> <code class="nf">Clear</code><code class="o">;</code>
<code class="lineno"> 8 </code>    <code class="k">function</code>  <code class="nf">Contains</code><code class="p">(</code><code class="n">value</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code>
<code class="lineno"> 9 </code>    <code class="k">function</code>  <code class="nf">Count</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code>
<code class="lineno">10 </code>    <code class="k">function</code>  <code class="nf">IsEmpty</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code>
<code class="lineno">11 </code>    <code class="k">function</code>  <code class="nf">Remove</code><code class="p">(</code><code class="n">value</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">boolean</code><code class="o">;</code>
<code class="lineno">12 </code>  <code class="cm">{$IFDEF OTL_HasArrayOfT}</code>
<code class="lineno">13 </code>    <code class="k">property</code> <code class="py">AsArray</code><code class="o">:</code> <code class="n">TArray</code><code class="o">&lt;</code><code class="kt">integer</code><code class="o">&gt;</code> <code class="kp">read</code> <code class="nf">GetAsArray</code> <code class="kp">write</code> <code class="nf">SetAsArray</code><code class="o">;</code>
<code class="lineno">14 </code>  <code class="cm">{$ENDIF OTL_HasArrayOfT}</code>
<code class="lineno">15 </code>    <code class="k">property</code> <code class="py">AsBits</code><code class="o">:</code> <code class="n">TBits</code> <code class="kp">read</code> <code class="nf">GetAsBits</code> <code class="kp">write</code> <code class="nf">SetAsBits</code><code class="o">;</code>
<code class="lineno">16 </code>    <code class="k">property</code> <code class="py">AsIntArray</code><code class="o">:</code> <code class="n">TIntegerDynArray</code> <code class="kp">read</code> <code class="nf">GetAsIntArray</code> <code class="kp">write</code> <code class="nf">SetAsIntArray</code><code class="o">;</code>
<code class="lineno">17 </code>    <code class="k">property</code> <code class="py">AsMask</code><code class="o">:</code> <code class="kt">int64</code> <code class="kp">read</code> <code class="nf">GetAsMask</code> <code class="kp">write</code> <code class="nf">SetAsMask</code><code class="o">;</code>
<code class="lineno">18 </code>    <code class="k">property</code> <code class="py">OnChange</code><code class="o">:</code> <code class="n">TOmniIntegerSetChangedEvent</code> <code class="kp">read</code> <code class="nf">GetOnChange</code> <code class="kp">write</code> <code class="nf">SetOnChange</code><code class="o">;</code>
<code class="lineno">19 </code>    <code class="k">property</code> <code class="py">Item</code><code class="p">[</code><code class="n">idx</code><code class="o">:</code> <code class="kt">integer</code><code class="p">]</code><code class="o">:</code> <code class="kt">integer</code> <code class="kp">read</code> <code class="nf">GetItem</code><code class="o">;</code> <code class="kp">default</code><code class="o">;</code>
<code class="lineno">20 </code>  <code class="k">end</code><code class="o">;</code> 
</pre></div>

</figure>

<p><code>Add</code> adds an element to the set and returns <code>True</code> if the element was previously present in the set, <code>False</code> if not.</p>

<p><code>Assign</code> assigns one set to another.</p>

<p><code>Clear</code> removes all elements from the set.</p>

<p><code>Contains</code> checks whether an element is present in the set.</p>

<p><code>Count</code> returns the number of elements in the set.</p>

<p><code>IsEmpty</code> returns <code>True</code> when set contains no elements.</p>

<p><code>Remove</code> removes an element from the set and returns <code>True</code> if the element was previously present in the set, <code>False</code> if not.</p>

<p><code>AsArray</code> is available only on Delphi 2010 and newer and allows the set to be accessed as a <code>TArray&lt;integer&gt;</code>.</p>

<p><code>AsBits</code> allows the code to access the set as Delphi’s <code>TBits</code> class.</p>

<p><code>AsIntArray</code> allows the code to access the set as an <code>array of integer</code>.</p>

<p><code>AsMask</code> allows the code to access the set as a bitfield mask. This is possible only if all values in the set are smaller than 64.</p>

<p><code>Item[]</code> allows the code to access the set as an indexed array of values, for example:</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno">1 </code><code class="k">for</code> <code class="n">i</code> <code class="o">:=</code> <code class="mi">0</code> <code class="k">to</code> <code class="n">omniSet</code><code class="o">.</code><code class="n">Count</code> <code class="o">-</code> <code class="mi">1</code> <code class="k">do</code>
<code class="lineno">2 </code>  <code class="n">DoSomethingWith</code><code class="p">(</code><code class="n">omniSet</code><code class="p">[</code><code class="n">i</code><code class="p">])</code><code class="o">;</code>
</pre></div>

</figure>

<p><code>OnChange</code> event is triggered each time the set is modified.</p>


<h3 id="misc-environment">
<span class="section-number">6.9 </span>Environment</h3>

<p>The <em>OtlCommon</em> unit implements function <code>Environment</code> which returns a global <code>IOmniEnvironment</code> singleton. This interface can be used to access information about the system, current process, and current thread.</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno"> 1 </code><code class="k">type</code>
<code class="lineno"> 2 </code>  <code class="n">IOmniEnvironment</code> <code class="o">=</code> <code class="k">interface</code>
<code class="lineno"> 3 </code>  <code class="cm">{$IFDEF OTL_NUMASupport}</code>
<code class="lineno"> 4 </code>    <code class="k">property</code> <code class="py">NUMANodes</code><code class="o">:</code> <code class="n">IOmniNUMANodes</code> <code class="kp">read</code> <code class="nf">GetNUMANodes</code><code class="o">;</code>
<code class="lineno"> 5 </code>    <code class="k">property</code> <code class="py">ProcessorGroups</code><code class="o">:</code> <code class="n">IOmniProcessorGroups</code> <code class="kp">read</code> <code class="nf">GetProcessorGroups</code><code class="o">;</code>
<code class="lineno"> 6 </code>  <code class="cm">{$ENDIF OTL_NUMASupport}</code>
<code class="lineno"> 7 </code>    <code class="k">property</code> <code class="py">Process</code><code class="o">:</code> <code class="n">IOmniProcessEnvironment</code> <code class="kp">read</code> <code class="nf">GetProcess</code><code class="o">;</code>
<code class="lineno"> 8 </code>    <code class="k">property</code> <code class="py">System</code><code class="o">:</code> <code class="n">IOmniSystemEnvironment</code> <code class="kp">read</code> <code class="nf">GetSystem</code><code class="o">;</code>
<code class="lineno"> 9 </code>    <code class="k">property</code> <code class="py">Thread</code><code class="o">:</code> <code class="n">IOmniThreadEnvironment</code> <code class="kp">read</code> <code class="nf">GetThread</code><code class="o">;</code>
<code class="lineno">10 </code>  <code class="k">end</code><code class="o">;</code> 
<code class="lineno">11 </code>
<code class="lineno">12 </code><code class="k">function</code>  <code class="nf">Environment</code><code class="o">:</code> <code class="n">IOmniEnvironment</code><code class="o">;</code>
</pre></div>

</figure>

<p>The <code>System</code> property allows you to get the number of processors (<code>Affinity</code>).</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno">1 </code><code class="k">type</code>
<code class="lineno">2 </code>  <code class="n">IOmniSystemEnvironment</code> <code class="o">=</code> <code class="k">interface</code>
<code class="lineno">3 </code>    <code class="k">property</code> <code class="py">Affinity</code><code class="o">:</code> <code class="n">IOmniAffinity</code> <code class="kp">read</code> <code class="nf">GetAffinity</code><code class="o">;</code>
<code class="lineno">4 </code>  <code class="k">end</code><code class="o">;</code> 
</pre></div>

</figure>

<p>The <code>Process</code> property gives you access to the number of processors, associated with the current process (<code>Affinity</code>), memory usage statistics (<code>Memory</code>), process priority (<code>PriorityClass</code>), and execution times (<code>Times</code>).</p>

<p>You can change the number of cores associated with the process by using the methods of the <code>Affinity</code> interface. All other information is read-only. </p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno"> 1 </code><code class="k">type</code>
<code class="lineno"> 2 </code>  <code class="c1">// from DSiWin32.pas</code>
<code class="lineno"> 3 </code>  <code class="n">_PROCESS_MEMORY_COUNTERS</code> <code class="o">=</code> <code class="k">packed</code> <code class="k">record</code>
<code class="lineno"> 4 </code>    <code class="n">cb</code><code class="o">:</code> <code class="kt">DWORD</code><code class="o">;</code>
<code class="lineno"> 5 </code>    <code class="n">PageFaultCount</code><code class="o">:</code> <code class="kt">DWORD</code><code class="o">;</code>
<code class="lineno"> 6 </code>    <code class="n">PeakWorkingSetSize</code><code class="o">:</code> <code class="kt">DWORD</code><code class="o">;</code>
<code class="lineno"> 7 </code>    <code class="n">WorkingSetSize</code><code class="o">:</code> <code class="kt">DWORD</code><code class="o">;</code>
<code class="lineno"> 8 </code>    <code class="n">QuotaPeakPagedPoolUsage</code><code class="o">:</code> <code class="kt">DWORD</code><code class="o">;</code>
<code class="lineno"> 9 </code>    <code class="n">QuotaPagedPoolUsage</code><code class="o">:</code> <code class="kt">DWORD</code><code class="o">;</code>
<code class="lineno">10 </code>    <code class="n">QuotaPeakNonPagedPoolUsage</code><code class="o">:</code> <code class="kt">DWORD</code><code class="o">;</code>
<code class="lineno">11 </code>    <code class="n">QuotaNonPagedPoolUsage</code><code class="o">:</code> <code class="kt">DWORD</code><code class="o">;</code>
<code class="lineno">12 </code>    <code class="n">PagefileUsage</code><code class="o">:</code> <code class="kt">DWORD</code><code class="o">;</code>
<code class="lineno">13 </code>    <code class="n">PeakPagefileUsage</code><code class="o">:</code> <code class="kt">DWORD</code><code class="o">;</code>
<code class="lineno">14 </code>  <code class="k">end</code><code class="o">;</code>
<code class="lineno">15 </code>  <code class="n">PROCESS_MEMORY_COUNTERS</code> <code class="o">=</code> <code class="n">_PROCESS_MEMORY_COUNTERS</code><code class="o">;</code>
<code class="lineno">16 </code>  <code class="n">PPROCESS_MEMORY_COUNTERS</code> <code class="o">=</code> <code class="o">^</code><code class="n">_PROCESS_MEMORY_COUNTERS</code><code class="o">;</code>
<code class="lineno">17 </code>  <code class="n">TProcessMemoryCounters</code> <code class="o">=</code> <code class="n">_PROCESS_MEMORY_COUNTERS</code><code class="o">;</code>
<code class="lineno">18 </code>  <code class="n">PProcessMemoryCounters</code> <code class="o">=</code> <code class="o">^</code><code class="n">_PROCESS_MEMORY_COUNTERS</code><code class="o">;</code>
<code class="lineno">19 </code>
<code class="lineno">20 </code>  <code class="c1">// from OtlCommon.pas</code>
<code class="lineno">21 </code>  <code class="n">TOmniProcessMemoryCounters</code> <code class="o">=</code> <code class="n">TProcessMemoryCounters</code><code class="o">;</code>
<code class="lineno">22 </code>  
<code class="lineno">23 </code>  <code class="n">TOmniProcessPriorityClass</code> <code class="o">=</code> <code class="p">(</code><code class="n">pcIdle</code><code class="o">,</code> <code class="n">pcBelowNormal</code><code class="o">,</code> <code class="n">pcNormal</code><code class="o">,</code> 
<code class="lineno">24 </code>    <code class="n">pcAboveNormal</code><code class="o">,</code> <code class="n">pcHigh</code><code class="o">,</code> <code class="n">pcRealtime</code><code class="p">)</code><code class="o">;</code>
<code class="lineno">25 </code>
<code class="lineno">26 </code>  <code class="n">TOmniProcessTimes</code> <code class="o">=</code> <code class="k">record</code>
<code class="lineno">27 </code>    <code class="n">CreationTime</code><code class="o">:</code> <code class="kt">TDateTime</code><code class="o">;</code>
<code class="lineno">28 </code>    <code class="n">UserTime</code>    <code class="o">:</code> <code class="kt">int64</code><code class="o">;</code>
<code class="lineno">29 </code>    <code class="n">KernelTime</code>  <code class="o">:</code> <code class="kt">int64</code><code class="o">;</code>
<code class="lineno">30 </code>  <code class="k">end</code><code class="o">;</code>
<code class="lineno">31 </code>
<code class="lineno">32 </code>  <code class="n">IOmniProcessEnvironment</code> <code class="o">=</code> <code class="k">interface</code>
<code class="lineno">33 </code>    <code class="k">property</code> <code class="py">Affinity</code><code class="o">:</code> <code class="n">IOmniAffinity</code> <code class="kp">read</code> <code class="nf">GetAffinity</code><code class="o">;</code>
<code class="lineno">34 </code>    <code class="k">property</code> <code class="py">Memory</code><code class="o">:</code> <code class="n">TOmniProcessMemoryCounters</code> <code class="kp">read</code> <code class="nf">GetMemory</code><code class="o">;</code>
<code class="lineno">35 </code>    <code class="k">property</code> <code class="py">PriorityClass</code><code class="o">:</code> <code class="n">TOmniProcessPriorityClass</code> <code class="kp">read</code> <code class="nf">GetPriorityClass</code><code class="o">;</code>
<code class="lineno">36 </code>    <code class="k">property</code> <code class="py">Times</code><code class="o">:</code> <code class="n">TOmniProcessTimes</code> <code class="kp">read</code> <code class="nf">GetTimes</code><code class="o">;</code>
<code class="lineno">37 </code>  <code class="k">end</code><code class="o">;</code> 
</pre></div>

</figure>

<p id="misc-environment-thread">The <code>Thread</code> property gives the programmer access to the number of processors, associated with the current process (<code>Affinity</code>), and to the thread ID (<code>ID</code>). You can change the number of cores associated with the process by using the methods of the <code>Affinity</code> interface. </p>

<p>On parallel systems with multiple processor groups<sup id="fnref-footnote-processor-groups"><a href="chap17.html#fn-footnote-processor-groups" rel="footnote">15</a></sup> you can use the <code>GroupAffinity</code> property to read or set group affinity for the current thread.</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno">1 </code><code class="k">type</code>
<code class="lineno">2 </code>  <code class="n">IOmniThreadEnvironment</code> <code class="o">=</code> <code class="k">interface</code>
<code class="lineno">3 </code>    <code class="k">property</code> <code class="py">Affinity</code><code class="o">:</code> <code class="n">IOmniAffinity</code> <code class="kp">read</code> <code class="nf">GetAffinity</code><code class="o">;</code>
<code class="lineno">4 </code>    <code class="k">property</code> <code class="py">GroupAffinity</code><code class="o">:</code> <code class="n">TOmniGroupAffinity</code> <code class="kp">read</code> <code class="nf">GetGroupAffinity</code> 
<code class="lineno">5 </code>      <code class="kp">write</code> <code class="nf">SetGroupAffinity</code><code class="o">;</code>
<code class="lineno">6 </code>    <code class="k">property</code> <code class="py">ID</code><code class="o">:</code> <code class="kt">cardinal</code> <code class="kp">read</code> <code class="nf">GetID</code><code class="o">;</code>
<code class="lineno">7 </code>  <code class="k">end</code><code class="o">;</code>
</pre></div>

</figure>

<p id="misc-environment-processorgroups">The <code>ProcessorGroups</code> property <sup>[3.06]</sup> is available only on Delphi 2009 and newer and gives you access to the information about processor groups in the computer.  </p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno">1 </code><code class="k">type</code>
<code class="lineno">2 </code>  <code class="n">IOmniProcessorGroups</code> <code class="o">=</code> <code class="k">interface</code>
<code class="lineno">3 </code>    <code class="k">function</code>  <code class="nf">All</code><code class="o">:</code> <code class="n">IOmniIntegerSet</code><code class="o">;</code>
<code class="lineno">4 </code>    <code class="k">function</code>  <code class="nf">Count</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code>
<code class="lineno">5 </code>    <code class="k">function</code>  <code class="nf">FindGroup</code><code class="p">(</code><code class="n">groupNumber</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="n">IOmniProcessorGroup</code><code class="o">;</code>
<code class="lineno">6 </code>    <code class="k">function</code>  <code class="nf">GetEnumerator</code><code class="o">:</code> <code class="n">TList</code><code class="o">&lt;</code><code class="n">IOmniProcessorGroup</code><code class="o">&gt;.</code><code class="n">TEnumerator</code><code class="o">;</code>
<code class="lineno">7 </code>    <code class="k">property</code> <code class="py">Item</code><code class="p">[</code><code class="n">idx</code><code class="o">:</code> <code class="kt">integer</code><code class="p">]</code><code class="o">:</code> <code class="n">IOmniProcessorGroup</code> <code class="kp">read</code> <code class="nf">GetItem</code><code class="o">;</code> <code class="kp">default</code><code class="o">;</code>
<code class="lineno">8 </code>  <code class="k">end</code><code class="o">;</code>
</pre></div>

</figure>

<p><code>All</code> returns a set of all processor group numbers.</p>

<p><code>Count</code> returns the number of processor groups in the system.</p>

<p><code>FindGroup</code> locates a group by its number.</p>

<p><code>GetEnumerator</code> allows you to use a <code>for..in</code> enumerator to access all processor groups.</p>

<p><code>Item[]</code> returns information on a specific processor group (<em>0</em> .. <code>Count - 1</code>).</p>

<p>For each processor group you can retrieve its number (<code>GroupNumber</code>) and processor affinity (<code>Affinity</code>).</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno">1 </code><code class="k">type</code>
<code class="lineno">2 </code>  <code class="n">IOmniProcessorGroup</code> <code class="o">=</code> <code class="k">interface</code>
<code class="lineno">3 </code>    <code class="k">property</code> <code class="py">GroupNumber</code><code class="o">:</code> <code class="kt">integer</code> <code class="kp">read</code> <code class="nf">GetGroupNumber</code><code class="o">;</code>
<code class="lineno">4 </code>    <code class="k">property</code> <code class="py">Affinity</code><code class="o">:</code> <code class="n">IOmniIntegerSet</code> <code class="kp">read</code> <code class="nf">GetAffinity</code><code class="o">;</code>
<code class="lineno">5 </code>  <code class="k">end</code><code class="o">;</code>
</pre></div>

</figure>

<p id="misc-environment-numanodes">The <code>NUMANodes</code> property <sup>[3.06]</sup> is available only on Delphi 2009 and newer and gives you access to the information about NUMA nodes<sup id="fnref-footnote-numa-nodes"><a href="chap17.html#fn-footnote-numa-nodes" rel="footnote">16</a></sup> in the computer.</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno">1 </code><code class="k">type</code>
<code class="lineno">2 </code>  <code class="n">IOmniNUMANodes</code> <code class="o">=</code> <code class="k">interface</code>
<code class="lineno">3 </code>    <code class="k">function</code>  <code class="nf">All</code><code class="o">:</code> <code class="n">IOmniIntegerSet</code><code class="o">;</code>
<code class="lineno">4 </code>    <code class="k">function</code>  <code class="nf">Count</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code>
<code class="lineno">5 </code>    <code class="k">function</code>  <code class="nf">Distance</code><code class="p">(</code><code class="n">fromNode</code><code class="o">,</code> <code class="n">toNode</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="kt">integer</code><code class="o">;</code>
<code class="lineno">6 </code>    <code class="k">function</code>  <code class="nf">FindNode</code><code class="p">(</code><code class="n">nodeNumber</code><code class="o">:</code> <code class="kt">integer</code><code class="p">)</code><code class="o">:</code> <code class="n">IOmniNUMANode</code><code class="o">;</code>
<code class="lineno">7 </code>    <code class="k">function</code>  <code class="nf">GetEnumerator</code><code class="o">:</code> <code class="n">TList</code><code class="o">&lt;</code><code class="n">IOmniNUMANode</code><code class="o">&gt;.</code><code class="n">TEnumerator</code><code class="o">;</code>
<code class="lineno">8 </code>    <code class="k">property</code> <code class="py">Item</code><code class="p">[</code><code class="n">idx</code><code class="o">:</code> <code class="kt">integer</code><code class="p">]</code><code class="o">:</code> <code class="n">IOmniNUMANode</code> <code class="kp">read</code> <code class="nf">GetItem</code><code class="o">;</code> <code class="kp">default</code><code class="o">;</code>
<code class="lineno">9 </code>  <code class="k">end</code><code class="o">;</code>
</pre></div>

</figure>

<p><code>All</code> returns a set of all NUMA node numbers in the system.</p>

<p><code>Count</code> returns the number of NUMA nodes in the system.</p>

<p><code>Distance</code> returns relative distance between nodes.<sup id="fnref-footnode-numa-relative-distance"><a href="chap17.html#fn-footnode-numa-relative-distance" rel="footnote">17</a></sup></p>

<p><code>FindNode</code> locates a node by its number.</p>

<p><code>GetEnumerator</code> allows you to use a <code>for..in</code> enumerator to access all NUMA nodes.</p>

<p><code>Item[]</code> returns information on a specific NUMA node (<em>0</em> .. <code>Count - 1</code>).</p>

<p>For each NUMA node you can retrieve its number (<code>NodeNumber</code>), the number of processor group this NUMA node belongs to (<code>GroupNumber</code>) and processor affinity (<code>Affinity</code>).</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno">1 </code>  <code class="n">IOmniNUMANode</code> <code class="o">=</code> <code class="k">interface</code>
<code class="lineno">2 </code>    <code class="k">property</code> <code class="py">NodeNumber</code><code class="o">:</code> <code class="kt">integer</code> <code class="kp">read</code> <code class="nf">GetNodeNumber</code><code class="o">;</code>
<code class="lineno">3 </code>    <code class="k">property</code> <code class="py">GroupNumber</code><code class="o">:</code> <code class="kt">integer</code> <code class="kp">read</code> <code class="nf">GetGroupNumber</code><code class="o">;</code>
<code class="lineno">4 </code>    <code class="k">property</code> <code class="py">Affinity</code><code class="o">:</code> <code class="n">IOmniIntegerSet</code> <code class="kp">read</code> <code class="nf">GetAffinity</code><code class="o">;</code>
<code class="lineno">5 </code>  <code class="k">end</code><code class="o">;</code>
</pre></div>

</figure>

<h4 id="leanpub-auto-iomniaffinity">
<span class="section-number">6.9.1 </span>IOmniAffinity</h4>

<p>The <code>IOmniAffinity</code> interface gives you a few different ways of modifying the number of processing cores, associated with the process or thread. It also allows you to read the information about processing cores in the system.</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno">1 </code><code class="k">type</code>
<code class="lineno">2 </code>  <code class="n">IOmniAffinity</code> <code class="o">=</code> <code class="k">interface</code>
<code class="lineno">3 </code>    <code class="k">property</code> <code class="py">AsString</code><code class="o">:</code> <code class="k">string</code> <code class="kp">read</code> <code class="nf">GetAsString</code> <code class="kp">write</code> <code class="nf">SetAsString</code><code class="o">;</code>
<code class="lineno">4 </code>    <code class="k">property</code> <code class="py">Count</code><code class="o">:</code> <code class="kt">integer</code> <code class="kp">read</code> <code class="nf">GetCount</code> <code class="kp">write</code> <code class="nf">SetCount</code><code class="o">;</code>
<code class="lineno">5 </code>    <code class="k">property</code> <code class="py">CountPhysical</code><code class="o">:</code> <code class="kt">integer</code> <code class="kp">read</code> <code class="nf">GetCountPhysical</code><code class="o">;</code>
<code class="lineno">6 </code>    <code class="k">property</code> <code class="py">Mask</code><code class="o">:</code> <code class="n">DSiNativeUInt</code> <code class="kp">read</code> <code class="nf">GetMask</code> <code class="kp">write</code> <code class="nf">SetMask</code><code class="o">;</code>
<code class="lineno">7 </code>  <code class="k">end</code><code class="o">;</code>
</pre></div>

</figure>

<p>The <code>AsString</code> property returns active (associated) cores as a string of characters. Following characters are used for cores from 0 to 63 (maximum number of cores available to a Win64 application).</p>

<blockquote>
  <p><code>0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz@$</code></p>
</blockquote>

<p>You can change associated cores by assigning to this property.</p>

<p>Example: The following program will force the current program to run only on cores 2, 4, 5, and 17 (provided that they exist in the system, of course).</p>

<figure class="code" dir="ltr">
<div class="highlight"><pre><code></code><code class="lineno">1 </code><code class="n">Environment</code><code class="o">.</code><code class="n">Process</code><code class="o">.</code><code class="n">Affinity</code><code class="o">.</code><code class="n">AsString</code> <code class="o">:=</code> <code class="s">'245H'</code><code class="o">;</code>
</pre></div>

</figure>

<p>The <code>Count</code> property returns the number of active (associated) cores. You can also assign a number to this property to change the number of associated cores. If you do that, the code uses a random number generator to select associated cores.</p>

<p>The <code>CountPhysical</code> property returns number of physical (non hyper-threaded) cores, associated with the current entity (system, process, or thread). This information is only available on Windows XP SP3 or newer. The value returned for <code>Count</code> will be used on older systems. On all other platforms it will return the same value as the <code>Count</code> property.</p>

<p>The <code>Mask</code> property returns a bitmask of active (associated) cores. Bit <em>0</em> represents the CPU 0 and so on. You can also change associated cores by assigning to this property.</p>



</div>
</body>

<!-- Mirrored from www.omnithreadlibrary.com/book/chap09.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 19 Oct 2025 22:29:01 GMT -->
</html>
